# MSW Template

## 공통 파일

### frontend/src/mocks/handlers.ts
```typescript
import { http, HttpResponse } from 'msw'

export const handlers = [
  http.get('/api/health', () => {
    return HttpResponse.json({ status: 'ok' })
  }),
]
```

### frontend/src/mocks/browser.ts
```typescript
import { setupWorker } from 'msw/browser'
import { handlers } from './handlers'

export const worker = setupWorker(...handlers)
```

---

## React (Vite)

### frontend/src/mocks/index.ts
```typescript
export async function initMocks() {
  if (import.meta.env.DEV) {
    const { worker } = await import('./browser')
    await worker.start({ onUnhandledRequest: 'bypass' })
  }
}
```

### frontend/src/main.tsx (덮어쓰기)
```tsx
import { createRoot } from 'react-dom/client'
import { App } from '@app/index'

// MSW 사용 시: npx msw init public 실행 후 아래 주석 해제
// async function bootstrap() {
//   const { initMocks } = await import('./mocks')
//   await initMocks()
//   createRoot(document.getElementById('root')!).render(<App />)
// }
// bootstrap()

createRoot(document.getElementById('root')!).render(<App />)
```

---

## Next.js

### frontend/src/mocks/index.ts
```typescript
export async function initMocks() {
  if (process.env.NODE_ENV === 'development') {
    const { worker } = await import('./browser')
    await worker.start({ onUnhandledRequest: 'bypass' })
  }
}
```

### frontend/app/layout.tsx (덮어쓰기)
```tsx
import type { Metadata } from 'next'
import { QueryProvider } from '@shared/lib/providers'
// import { MSWProvider } from '@shared/lib/providers'
import '@shared/styles/global.scss'

export const metadata: Metadata = {
  title: 'App',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="ko">
      <body className="min-h-screen antialiased">
        {/* MSW 사용 시: npx msw init public 실행 후 아래 주석 해제 */}
        {/* <MSWProvider> */}
        <QueryProvider>
          {children}
        </QueryProvider>
        {/* </MSWProvider> */}
      </body>
    </html>
  )
}
```

### frontend/src/shared/lib/providers/index.ts (덮어쓰기)
```typescript
export { QueryProvider } from './QueryProvider'
export { MSWProvider } from './MSWProvider'
```

### frontend/src/shared/lib/providers/MSWProvider.tsx
```tsx
'use client'

import { useEffect, useState } from 'react'

export function MSWProvider({ children }: { children: React.ReactNode }) {
  const [isReady, setIsReady] = useState(false)

  useEffect(() => {
    async function init() {
      const { initMocks } = await import('../../../mocks')
      await initMocks()
      setIsReady(true)
    }
    init()
  }, [])

  if (!isReady) return null

  return <>{children}</>
}
```
